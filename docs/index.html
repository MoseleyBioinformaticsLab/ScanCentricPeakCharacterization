<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Provides a functions and classes for detecting,
        characterizing, and integrating peaks in a scan-centric manner
        from direct-injection mass spectrometry data.">
<title>Functionality for Characterizing Peaks in Mass Spectrometry in a
        Scan-Centric Manner • ScanCentricPeakCharacterization</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Functionality for Characterizing Peaks in Mass Spectrometry in a
        Scan-Centric Manner">
<meta property="og:description" content="Provides a functions and classes for detecting,
        characterizing, and integrating peaks in a scan-centric manner
        from direct-injection mass spectrometry data.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-dark"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">ScanCentricPeakCharacterization</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.20</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="articles/Quick_Start.html">Quick Start</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="scancentricpeakcharacterization">ScanCentricPeakCharacterization<a class="anchor" aria-label="anchor" href="#scancentricpeakcharacterization"></a>
</h1></div>
<p>The goal of the ScanCentricPeakCharacterization package is to facilitate scan-centric, frequency based, peak characterization of profile level, multi-scan, direct-injection Fourier-transform mass spectrometry data.</p>
<p>You can read more about the merits of this scan-centric method in:</p>
<p>RM Flight, JM Mitchell &amp; HNB Moseley, “Scan-Centric, Frequency-Based Method for Characterizing Peaks from Direct Injection Fourier transform Mass Spectrometry Experiments”, bioRxiv, doi: <a href="https://doi.org/10.1101/2022.04.14.488423" class="external-link uri">https://doi.org/10.1101/2022.04.14.488423</a></p>
<div class="section level2">
<h2 id="license">License<a class="anchor" aria-label="anchor" href="#license"></a>
</h2>
<p>This package is licensed with a <a href="LICENSE.html">BSD-like license</a> with a 4th clause: <strong>No commercial use.</strong></p>
<p>Academics who want to use it at their institution, please try it.</p>
<p>If you are at a business / for-profit and want to use it, please contact the authors (Robert Flight, rflight79 at gmail; Hunter Moseley, hunter dot moseley at gmail) about licensing. Please contact us even if you aren’t sure what would be required for licensing, we do want people to use it.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install ScanCentricPeakCharacterization from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("remotes")</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"MoseleyBioinformaticsLab/ScanCentricPeakCharacterization"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="documentation-site">Documentation Site<a class="anchor" aria-label="anchor" href="#documentation-site"></a>
</h2>
<p>You can browse the documentation online <a href="https://moseleybioinformaticslab.github.io/ScanCentricPeakCharacterization" class="external-link">here</a>.</p>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ScanCentricPeakCharacterization</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/theme_cowplot.html" class="external-link">theme_cowplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="theory">Theory<a class="anchor" aria-label="anchor" href="#theory"></a>
</h2>
<div class="section level3">
<h3 id="converting-mz-to-frequency">Converting m/z to Frequency<a class="anchor" aria-label="anchor" href="#converting-mz-to-frequency"></a>
</h3>
<p>Outside of the scan-centric nature of this peak-characterization, the second most important feature is the conversion from m/z to frequency. This is done to make evenly spaced data. If you acquire Orbitrap / ICR type mass spectrometry data over any decent range, there is an increasing spacing between individual m/z points.</p>
<p>We will load up an example direct-injection lipidomics sample acquired on a Thermo-Fisher Fusion instrument to demonstrate.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mzml_lipid</span> <span class="op">=</span> <span class="va"><a href="reference/SCMzml.html">SCMzml</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/lipid_example.mzML"</span>, package <span class="op">=</span> <span class="st">"ScanCentricPeakCharacterization"</span><span class="op">)</span><span class="op">)</span>
<span class="va">mzml_lipid</span><span class="op">$</span><span class="fu">extract_mzml_data</span><span class="op">(</span><span class="op">)</span>
<span class="va">mzml_lipid</span><span class="op">$</span><span class="fu">predict_frequency</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mzml_lipid</span><span class="op">$</span><span class="va">mzml_df_data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">convertable</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mz</span>, y <span class="op">=</span> <span class="va">mean_offset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-show_spacing-1.png" width="100%"></p>
<p>We can see here that the difference or offset of m/z points is increasing with m/z.</p>
<p>In contrast, frequency is defined as the difference over m/z, and therefore is constant.</p>
<div class="figure">
<img src="https://latex.codecogs.com/png.image?%5Cdpi%7B110%7D&amp;space;%5Cbg_white&amp;space;mz_%7Bmean%7D%20%3D%20mean%28mz_%7Bp1%7D%2C%20mz_%7Bp2%7D%29" title="mz_{mean} = mean(mz_{p1}, mz_{p2})" alt=""><p class="caption">mz_{mean} = mean(mz_{p1}, mz_{p2})</p>
</div>
<div class="figure">
<img src="https://latex.codecogs.com/png.image?%5Cdpi%7B110%7D&amp;space;%5Cbg_white&amp;space;mz_%7Bdiff%7D%20%3D%20mz_%7Bp2%7D%20-%20mz_%7Bp1%7D" title="mz_{diff} = mz_{p2} - mz_{p1}" alt=""><p class="caption">mz_{diff} = mz_{p2} - mz_{p1}</p>
</div>
<div class="figure">
<img src="https://latex.codecogs.com/png.image?%5Cdpi%7B110%7D&amp;space;%5Cbg_white&amp;space;frequency%20%3D%20%5Cfrac%7Bmz_%7Bmean%7D%7D%7Bmz_%7Bdiff%7D%7D" title="frequency = \frac{mz_{mean}}{mz_{diff}}" alt=""><p class="caption">frequency = \frac{mz_{mean}}{mz_{diff}}</p>
</div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mzml_lipid</span><span class="op">$</span><span class="va">mzml_df_data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">convertable</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mean_frequency</span>, y <span class="op">=</span> <span class="va">mean_freq_diff</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-show_frequency-1.png" width="100%"></p>
<p>However, we can more generally define the conversion of m/z to frequency using a linear model of the form:</p>
<div class="figure">
<img src="https://latex.codecogs.com/png.image?%5Cdpi%7B110%7D&amp;space;%5Cbg_white&amp;space;frequency%20%3D%20a%20%2B%20%5Cfrac%7Bx%7D%7Bmz%7D%20%2B%20%20%5Cfrac%7By%7D%7B%5Csqrt%7Bmz%7D%7D%20%2B%20%5Cfrac%7Bz%7D%7B%5Csqrt%5B3%5D%7Bmz%7D%7D" title="frequency = a + \frac{x}{mz} + \frac{y}{\sqrt{mz}} + \frac{z}{\sqrt[3]{mz}}" alt=""><p class="caption">frequency = a + \frac{x}{mz} + \frac{y}{\sqrt{mz}} + \frac{z}{\sqrt[3]{mz}}</p>
</div>
<p>And we can verify that with a plot of the m/z vs frequency and their predicted values, in a couple of ways, as well as a plot of the residuals.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mzml_lipid</span><span class="op">$</span><span class="fu">check_frequency_model</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-show_predictions-1.png" width="100%"></p>
<p>See the example of <code>SCRaw</code> below to see how we can change the model being used.</p>
</div>
</div>
<div class="section level2">
<h2 id="basic-objects-and-classes">Basic Objects and Classes<a class="anchor" aria-label="anchor" href="#basic-objects-and-classes"></a>
</h2>
<div class="section level3">
<h3 id="sccharacterizepeaks">SCCharacterizePeaks<a class="anchor" aria-label="anchor" href="#sccharacterizepeaks"></a>
</h3>
<p><code>SCCharacterizePeaks</code> controls the overall interplay between:</p>
<ul>
<li>the <code>SCZip</code> container that will hold the original and final data;</li>
<li>the <code>SCMzml</code> object that loads mzml data, transforms it to frequency space, and filters out scans that don’t seem to belong;</li>
<li>the <code>SCPeakRegion</code> and <code>SCPeakRegionFinder</code> that actually do all of the peak characterization.</li>
</ul>
<p>It also has the ability to do the first preparation steps of the data and check that the frequency model is appropriate.</p>
<p>Let’s give an example using an example lipid file.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lipid_sample</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"lipid_example.mzML"</span>, package <span class="op">=</span> <span class="st">"ScanCentricPeakCharacterization"</span><span class="op">)</span>
<span class="va">sc_char</span> <span class="op">=</span> <span class="va"><a href="reference/SCCharacterizePeaks.html">SCCharacterizePeaks</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">lipid_sample</span>, out_file <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"lipid_sample.zip"</span><span class="op">)</span><span class="op">)</span>

<span class="va">sc_char</span><span class="op">$</span><span class="fu">load_file</span><span class="op">(</span><span class="op">)</span>
<span class="va">sc_char</span><span class="op">$</span><span class="fu">prepare_mzml_data</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="section level4">
<h4 id="check-frequency-model">Check Frequency Model<a class="anchor" aria-label="anchor" href="#check-frequency-model"></a>
</h4>
<p>And now we can check that our frequency model should work for the rest of the steps.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sc_char</span><span class="op">$</span><span class="fu">check_frequency_model</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-check_frequency-1.png" width="100%"></p>
<p>If the frequency model was wrong, then we should instantiate a new one with a different model.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">freq_model</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a.freq"</span> <span class="op">=</span> <span class="fl">0</span>, <span class="st">"x.freq"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, <span class="st">"y.freq"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="fl">2</span>, <span class="st">"z.freq"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span>
<span class="va">freq_model2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a.freq"</span> <span class="op">=</span> <span class="fl">0</span>, <span class="st">"x.freq"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, <span class="st">"y.freq"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span>

<span class="va">sc_char</span><span class="op">$</span><span class="fu">set_frequency_fit_description</span><span class="op">(</span><span class="va">freq_model2</span><span class="op">)</span>
<span class="va">sc_char</span><span class="op">$</span><span class="fu">predict_frequency</span><span class="op">(</span><span class="op">)</span>

<span class="va">sc_char</span><span class="op">$</span><span class="fu">check_frequency_model</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-example_char2-1.png" width="100%"></p>
<p>This model is definitely incorrect. We can see this from the plot of residuals by m/z, and the MAD (median absolute deviations) and median differences of the residuals across the scans are very, very high.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sc_char</span><span class="op">$</span><span class="fu">set_frequency_fit_description</span><span class="op">(</span><span class="va">freq_model</span><span class="op">)</span>
<span class="va">sc_char</span><span class="op">$</span><span class="fu">predict_frequency</span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="check-scans-kept">Check Scans Kept<a class="anchor" aria-label="anchor" href="#check-scans-kept"></a>
</h4>
<p>We can also check which peaks were excluded by examining the <code>scan_info</code> data.frame.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">scan_info</span> <span class="op">=</span> <span class="va">sc_char</span><span class="op">$</span><span class="fu">scan_info</span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">scan_info</span><span class="op">)</span>
<span class="co">#&gt;   scanIndex scan polarity      rtime       tic rtime_lag rtime_lead rtime_keep y_freq_keep</span>
<span class="co">#&gt; 1         1 s.01        1  0.8358959 429046848        NA   11.06028       TRUE        TRUE</span>
<span class="co">#&gt; 2         2 s.02        1 11.8961766 282278784  11.06028   11.07281       TRUE        TRUE</span>
<span class="co">#&gt; 3         3 s.03        1 22.9689818 439026304  11.07281   11.04548       TRUE        TRUE</span>
<span class="co">#&gt; 4         4 s.04        1 34.0144615 429789920  11.04548   11.04705       TRUE        TRUE</span>
<span class="co">#&gt; 5         5 s.05        1 45.0615118 433693216  11.04705   11.04636       TRUE        TRUE</span>
<span class="co">#&gt; 6         6 s.06        1 56.1078670 429844288  11.04636   11.04656       TRUE        TRUE</span>
<span class="co">#&gt;   stats_keep keep        mad      median    a.freq   x.freq   y.freq   z.freq        a.mz      x.mz</span>
<span class="co">#&gt; 1       TRUE TRUE 0.09488578 -0.01991055 -36.29313 4339.548 29800864 1070.974 0.003203856 -19081.56</span>
<span class="co">#&gt; 2       TRUE TRUE 0.11431756 -0.02607351 -42.73811 5607.854 29800327 1289.635 0.003874297 -22330.45</span>
<span class="co">#&gt; 3       TRUE TRUE 0.08638029 -0.01477036 -37.93255 4734.174 29800719 1129.750 0.002996038 -18154.25</span>
<span class="co">#&gt; 4       TRUE TRUE 0.09700394 -0.03144327 -37.61949 4656.438 29800744 1119.253 0.004465065 -24589.24</span>
<span class="co">#&gt; 5       TRUE TRUE 0.08886880 -0.01449103 -35.80378 4281.555 29800892 1056.818 0.003222591 -19116.27</span>
<span class="co">#&gt; 6       TRUE TRUE 0.10315704 -0.01284821 -41.00362 5388.045 29800458 1236.099 0.004144753 -23243.80</span>
<span class="co">#&gt;           y.mz          z.mz</span>
<span class="co">#&gt; 1 8.882685e+14 -1.900395e+16</span>
<span class="co">#&gt; 2 8.882729e+14 -2.130416e+16</span>
<span class="co">#&gt; 3 8.882673e+14 -1.836750e+16</span>
<span class="co">#&gt; 4 8.882763e+14 -2.247840e+16</span>
<span class="co">#&gt; 5 8.882683e+14 -1.894065e+16</span>
<span class="co">#&gt; 6 8.882745e+14 -2.166934e+16</span>

<span class="va">scan_info</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rtime</span>, xend <span class="op">=</span> <span class="va">rtime</span>, y <span class="op">=</span> <span class="fl">0</span>, yend <span class="op">=</span> <span class="va">tic</span>, color <span class="op">=</span> <span class="va">keep</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-check_scans-1.png" width="100%"></p>
<p>We can see that several scans were excluded by being too high in their retention time (rtime), and then two were outliers based on the statistics of the frequency square root coefficient.</p>
<p>If this isn’t doing what we want, we can define a different scan-filtering function that does more along the lines of what we want. See the documentation about <code><a href="reference/add_scan_info.html">add_scan_info()</a></code> using <code><a href="reference/add_scan_info.html">?add_scan_info</a></code> to see what is generally available.</p>
</div>
<div class="section level4">
<h4 id="run-peak-characterization">Run Peak Characterization<a class="anchor" aria-label="anchor" href="#run-peak-characterization"></a>
</h4>
<p>Once we are happy with how we have set up the <code>SCCharacterizePeaks</code> object, we can run the peak characterization.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># not run</span>
<span class="va">sc_char</span><span class="op">$</span><span class="fu">find_peaks</span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="run-everything">Run Everything<a class="anchor" aria-label="anchor" href="#run-everything"></a>
</h4>
<p>If you’ve already examined the model, and have your function for filtering scans all set up, then you can run everything on your sample rather quickly using this simple command:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># not run</span>
<span class="va">sc_char</span> <span class="op">=</span> <span class="va"><a href="reference/SCCharacterizePeaks.html">SCCharacterizePeaks</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"file.mzML"</span>, out_file <span class="op">=</span> <span class="st">"file.zip"</span><span class="op">)</span>
<span class="va">sc_char</span><span class="op">$</span><span class="fu">run_all</span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="scmzml">SCMzml<a class="anchor" aria-label="anchor" href="#scmzml"></a>
</h3>
<p><code>SCMzml</code> is responsible for loading the raw data, holding per-scan metadata, extracting the scan-level m/z and intensity, converting them to frequency, and filtering any scans out. Although the user should not have to interact with it much, and <strong>normally</strong> it is controlled by <code>SCCharacterizePeaks</code>, we mention it here so that the user knows it exists.</p>
</div>
<div class="section level3">
<h3 id="scpeakregionfinder">SCPeakRegionFinder<a class="anchor" aria-label="anchor" href="#scpeakregionfinder"></a>
</h3>
<p><code>SCPeakRegionFinder</code> is similar to <code>SCCharacterizePeaks</code> in that it is more of a controlling workflow object. It serves to coordinate all the steps that need to happen for peak characterization outside of the conversion to frequency, which is the purview of the <code>SCMzml</code> object. The <code>SCPeakRegionFinder</code> acts on the <code>SCPeakRegions</code> object, which has all of the data and methods.</p>
</div>
<div class="section level3">
<h3 id="scpeakregions">SCPeakRegions<a class="anchor" aria-label="anchor" href="#scpeakregions"></a>
</h3>
<p><code>SCPeakRegions</code> holds the frequency data and the methods. It is controlled by <code>SCPeakRegionFinder</code>.</p>
</div>
<div class="section level3">
<h3 id="sczip">SCZip<a class="anchor" aria-label="anchor" href="#sczip"></a>
</h3>
<p>We wanted a fairly generic way to store the original mzML file, any metadata generated about it, the binary output of <code>SCPeakRegionFinder</code>, and a JSONized peak list that can be used for assignment. What we decided on was a simple zip file that keeps those objects together. When we create a new <code>SCZip</code>, we actually create a temp directory, and move all the data there, and unzip it so that it is easily accessible and pieces can be modified easily.</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing ScanCentricPeakCharacterization</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Robert M Flight <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Robert M Flight.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
